<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thêm/Chỉnh sửa phiếu giảm giá</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/Sidebar.css}">
</head>
<body>
<div class="wrapper">
    <div th:replace="fragments/sidebar :: sidebar"></div>
    <div class="main-content">
        <div th:replace="fragments/topbar :: topbar"></div>
        <div class="content-area container mt-4">
            <h3 class="mb-4"
                th:text="${coupon.couponId != null} ? 'Chỉnh sửa phiếu giảm giá' : 'Tạo phiếu giảm giá mới'"></h3>

            <form th:action="@{${coupon.couponId != null} ? '/admin/coupons/edit/' + ${coupon.couponId} : '/admin/coupons/create'}" method="post">
                <div class="mb-3">
                    <label class="form-label">Mã giảm giá</label>
                    <div class="input-group">
                        <input type="text" name="code" class="form-control" th:value="${coupon.code}" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="generateCode()">Tạo mới</button>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Loại</label>
                    <select name="type" class="form-select" required>
                        <option th:each="t : ${T(com.teamforone.tech_store.model.Coupon.CouponType).values()}"
                                th:value="${t}" th:text="${t}" th:selected="${t == coupon.type}"></option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Giá trị</label>
                    <input type="number" step="1" name="value" class="form-control" th:value="${coupon.value}" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Giá trị tối thiểu đơn hàng</label>
                    <input type="number" step="1" name="minOrderAmount" class="form-control" th:value="${coupon.minOrderAmount}">
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Ngày bắt đầu</label>
                        <input type="datetime-local" name="startsAt" class="form-control"
                               th:value="${coupon.startsAt != null} ? ${#dates.format(coupon.startsAt,'yyyy-MM-dd''T''HH:mm')} : ''">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ngày kết thúc</label>
                        <input type="datetime-local" name="endsAt" class="form-control"
                               th:value="${coupon.endsAt != null} ? ${#dates.format(coupon.endsAt,'yyyy-MM-dd''T''HH:mm')} : ''">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Giới hạn số lần sử dụng</label>
                    <input type="number" name="usageLimit" class="form-control" th:value="${coupon.usageLimit}">
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" name="active" class="form-check-input" th:checked="${coupon.active}">
                    <label class="form-check-label">Kích hoạt</label>
                </div>

                <button type="submit" class="btn btn-primary"
                        th:text="${coupon.couponId != null} ? 'Cập nhật' : 'Tạo mới'"></button>
                <a th:href="@{/admin/coupons}" class="btn btn-secondary">Hủy</a>
            </form>
        </div>
    </div>
</div>

<script>
    function generateCode() {
        fetch('/admin/coupons/generate-code')
            .then(res => res.text())
            .then(code => document.querySelector('input[name="code"]').value = code)
            .catch(err => console.error('Không thể tạo mã:', err));
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
